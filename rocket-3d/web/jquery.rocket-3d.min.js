(function(b){b.fn.rocket3d=function(a){var l={enterOn:"now",delayTime:5E3,width:b(window).width(),height:b(window).height(),far:1E4,near:0.1,angle:40,show_stats:!1,stars:800,konami_code:"38,38,40,40,37,39,37,39,66,65",show_wireframes:!1,use_mouse:!0,camera_z_position:1500,light_color:16777215,orbit_light_color:16746496,rocket_obj:"obj/rocket3d.js",rocket_tex:"tex/rocket3d_uvmap.png",rocket_rotation:{x:Math.PI/2,y:Math.PI*1.1,z:Math.PI/2},fire_obj:"obj/rocket3d_flame.js",fire_color:16759552,onInitCallback:!1,
playSong:"mus/space-loop-2.ogg"},a=b.extend(l,a);return this.each(function(){function i(){function q(a,b){var d=Math.random()*100+100;b&&(new TWEEN.Tween(b)).to({intensity:d/5},150).easing(TWEEN.Easing.Cubic.EaseIn).start();(new TWEEN.Tween(a.scale)).to({x:d,y:d,z:d},150).easing(TWEEN.Easing.Cubic.EaseIn).onComplete(function(){q(a,b,d)}).start()}function i(a){(new TWEEN.Tween(a.rotation)).to({x:Math.random()*Math.PI/15,y:Math.random()*Math.PI/20,z:Math.random()*Math.PI/15},930).easing(TWEEN.Easing.Linear.EaseNone).onComplete(function(){i(a)}).start()}
function l(){requestAnimationFrame(l);if(j){var b=Date.now()*5.0E-4;j.position.x=Math.sin(b*1)*500;j.position.y=Math.cos(b*1)*300;j.position.z=Math.cos(b*1)*200}c.position.x+=(m-c.position.x)*1;c.position.y+=(-r-c.position.y)*1;c.lookAt(f.position);s.position.x-=0.5;TWEEN.update();n.render(f,c);a.show_stats&&g&&g.update()}if(!t)if(t=!0,typeof Detector=="undefined"||!Detector.webgl)Detector.addGetWebGLMessage();else{var c,f,h,n,e,k,o,j,g=!1,m=0,r=0,p=a.width/2,x=a.height/2;k=a.width/a.height;b("body").append('<div id="rocket3dcontainer"></div>');
h=b("#rocket3dcontainer");h.css({position:"absolute",width:a.width,height:a.height,top:0,left:0});h.css({background:"#000000"});h.hide();h.fadeIn(3E3);c=new THREE.PerspectiveCamera(a.angle,k,a.near,a.far);c.position.z=a.camera_z_position;f=new THREE.Scene;f.fog=new THREE.FogExp2(8947848,3.0E-4);f.fog.color.setRGB(0.5,0.5,0.5);k=new THREE.DirectionalLight(a.light_color);k.position.set(0,0,1).normalize();f.add(k);var u=new THREE.JSONLoader;k=new THREE.ParticleBasicMaterial({color:16738047,size:15,blending:THREE.AdditiveBlending,
transparent:!0});for(var v=new THREE.Geometry,w=0;w<a.stars;w++)v.vertices.push(new THREE.Vertex(new THREE.Vector3(Math.random()*a.camera_z_position*15-a.camera_z_position*3,Math.random()*a.camera_z_position*6-a.camera_z_position*3,-1E3)));var s=new THREE.ParticleSystem(v,k);f.add(s);u.load(a.rocket_obj,function(c){c.materials[0].shading=THREE.FlatShading;e=new THREE.Object3D;e.position.x=-300;e.rotation={x:a.rocket_rotation.x,y:a.rocket_rotation.y,z:a.rocket_rotation.z};e.scale.x=e.scale.y=e.scale.z=
150;var g=new THREE.Mesh(c,new THREE.MeshPhongMaterial({map:THREE.ImageUtils.loadTexture(a.rocket_tex)}));e.add(g);a.show_wireframes&&(c=new THREE.Mesh(c,new THREE.MeshLambertMaterial({color:16711680,opacity:0.9,shading:THREE.FlatShading,wireframe:!0,wireframeLinewidth:2,transparent:!0})),e.add(c));h.parent().css("overflow","hidden");b("html,body").css("overflow","hidden");b("html:not(:animated),body:not(:animated)").animate({scrollTop:0},500);if(a.onInitCallback)a.onInitCallback();u.load(a.fire_obj,
function(d){d.materials[0].shading=THREE.FlatShading;mesh2=new THREE.Object3D;mesh2.position=e.position;mesh2.rotation=e.rotation;mesh2.scale.x=mesh2.scale.y=mesh2.scale.z=150;var c=new THREE.Mesh(d,new THREE.MeshBasicMaterial({color:a.fire_color,opacity:0.9,overdraw:!1}));mesh2.add(c);a.show_wireframes&&(d=new THREE.Mesh(d,new THREE.Mesh({color:16711680,opacity:0.9,shading:THREE.FlatShading,wireframe:!0,wireframeLinewidth:2,transparent:!0})),mesh2.add(d));pointLight=!1;d=new THREE.Object3D;o=new THREE.PointLight(a.orbit_light_color,
5,300);f.add(o);o.intensity=5;c=new THREE.SphereGeometry(5,16,8);j=new THREE.Mesh(c,new THREE.MeshBasicMaterial({color:a.orbit_light_color}));j.position=o.position;f.add(j);d.add(e);d.add(mesh2);f.add(d);q(mesh2,pointLight,150);i(d);a.playSong&&b("body").append('<audio src="'+a.playSong+'" autoplay loop></audio>');l()})});n=new THREE.WebGLRenderer({antialias:!0});n.setSize(a.width,a.height);h.append(n.domElement);if(a.show_stats&&typeof Stats!="undefined")g=new Stats,g.domElement.style.position="absolute",
g.domElement.style.top="0px",g.domElement.style.right="0px",h.append(g.domElement);a.use_mouse&&document.addEventListener("mousemove",function(a){m=(a.clientX-p)*2;r=(a.clientY-x)*2},!1)}}var l=b(this),t=!1;if(a.enterOn=="now")i();else if(a.enterOn=="timer")setTimeout(i,a.delayTime);else if(a.enterOn=="click")l.bind("click",function(a){a.preventDefault();i()});else if(a.enterOn=="konami-code"){var m=[],p=a.konami_code;b(window).bind("keydown.rocketz",function(a){m.push(a.keyCode);m.toString().indexOf(p)>=
0&&(i(),m=[])},!0)}})}})(jQuery);
