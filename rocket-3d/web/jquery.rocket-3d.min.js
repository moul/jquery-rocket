(function(e){e.fn.rocket3d=function(a){var n={enterOn:"now",delayTime:5E3,width:e(window).width(),height:e(window).height(),far:1E4,near:0.1,angle:40,show_stats:!0,stars:800,konami_code:"38,38,40,40,37,39,37,39,66,65",show_wireframes:!1,use_mouse:!0,camera_z_position:1500,light_color:16777215,orbit_light_color:16746496,rocket_obj:"obj/rocket3d.js",rocket_tex:"tex/rocket3d_uvmap.png",rocket_rotation:{x:Math.PI/2,y:Math.PI*1.1,z:Math.PI/2},fire_particles:1800,fire_obj:"obj/rocket3d_flame.js",fire_color:16759552,
onInitCallback:!1,playSong:["mus/space-loop-2.ogg","mus/space-loop-2.mp3","mus/space-loop-2.mp4"],playSong_volume:0.7},a=e.extend(n,a);return this.each(function(){function j(){function v(a,d){var c=Math.random()*100+100;d&&(new TWEEN.Tween(d)).to({intensity:c/5},150).easing(TWEEN.Easing.Cubic.EaseIn).start();(new TWEEN.Tween(a.scale)).to({x:c,y:c,z:c},150).easing(TWEEN.Easing.Cubic.EaseIn).onComplete(function(){v(a,d,c)}).start()}function j(b){(new TWEEN.Tween(b.rotation)).to({x:a.rocket_rotation.x+
Math.random()*Math.PI/15,y:a.rocket_rotation.y+Math.random()*Math.PI/20,z:a.rocket_rotation.z+Math.random()*Math.PI/15},930).easing(TWEEN.Easing.Linear.EaseNone).onComplete(function(){j(b)}).start()}function n(){requestAnimationFrame(n);if(k){var b=Date.now()*5.0E-4;k.position.x=Math.sin(b*1)*500;k.position.y=Math.cos(b*1)*300;k.position.z=Math.cos(b*1)*200}f.position.x+=(o-f.position.x)*1;f.position.y+=(-w-f.position.y)*1;f.lookAt(h.position);x.position.x-=0.5;if(a.fire_particles){for(b=0;b<t;b++){var d=
p.vertices[b];if(d.position.y<0-Math.random()*100-200){var c=d.position;c.x=0;c.y=0;c.z=0;d.velocity.y=0}d.velocity.y-=Math.random()*0.1;d.position.addSelf(d.velocity)}t<a.fire_particles&&(t+=10);q.geometry.__dirtyVertices=!0}TWEEN.update();r.render(h,f);a.show_stats&&l&&l.update()}if(!y)if(y=!0,typeof Detector=="undefined"||!Detector.webgl)Detector.addGetWebGLMessage();else{var f,h,i,r,g,m,s,k,p,q,l=!1,o=0,w=0,u=a.width/2,C=a.height/2;m=a.width/a.height;e("body").append('<div id="rocket3dcontainer"></div>');
i=e("#rocket3dcontainer");i.css({position:"absolute",width:a.width,height:a.height,top:0,left:0});i.css({background:"#000000"});i.hide();i.fadeIn(3E3);f=new THREE.PerspectiveCamera(a.angle,m,a.near,a.far);f.position.z=a.camera_z_position;h=new THREE.Scene;m=new THREE.DirectionalLight(a.light_color);m.position.set(0,0,1).normalize();h.add(m);var z=new THREE.JSONLoader;m=new THREE.ParticleBasicMaterial({color:16738047,size:15,blending:THREE.AdditiveBlending,transparent:!0});for(var A=new THREE.Geometry,
B=0;B<a.stars;B++)A.vertices.push(new THREE.Vertex(new THREE.Vector3(Math.random()*a.camera_z_position*15-a.camera_z_position*3,Math.random()*a.camera_z_position*6-a.camera_z_position*3,-1E3)));var x=new THREE.ParticleSystem(A,m);h.add(x);z.load(a.rocket_obj,function(b){b.materials[0].shading=THREE.FlatShading;g=new THREE.Object3D;g.position.x=0;g.scale.x=g.scale.y=g.scale.z=150;var d=new THREE.Mesh(b,new THREE.MeshPhongMaterial({map:THREE.ImageUtils.loadTexture(a.rocket_tex)}));g.add(d);a.show_wireframes&&
(b=new THREE.Mesh(b,new THREE.MeshLambertMaterial({color:16711680,opacity:0.9,shading:THREE.FlatShading,wireframe:!0,wireframeLinewidth:2,transparent:!0})),g.add(b));i.parent().css("overflow","hidden");e("html,body").css("overflow","hidden");e("html:not(:animated),body:not(:animated)").animate({scrollTop:0},500);if(a.onInitCallback)a.onInitCallback();z.load(a.fire_obj,function(c){var b=new THREE.Object3D;b.rotation={x:a.rocket_rotation.x,y:a.rocket_rotation.y,z:a.rocket_rotation.z};b.position.x=-250;
if(a.fire_particles){p=new THREE.Geometry;var d=new THREE.ParticleBasicMaterial({size:60,map:THREE.ImageUtils.loadTexture("tex/fireParticle.png"),blending:THREE.AdditiveBlending,transparent:!0,vertexColors:!0}),e=[];p.colors=e;for(c=0;c<a.fire_particles;c++){var f=new THREE.Vertex(new THREE.Vector3(0,0,0));f.velocity=new THREE.Vector3((Math.random()-0.5)*2,-Math.random(),-Math.random()+Math.random()*2);p.vertices.push(f);f=new THREE.Color(Math.random()*16777215);e[c]=f}q=new THREE.ParticleSystem(p,
d);q.sortParticles=!0;b.add(q)}else c.materials[0].shading=THREE.FlatShading,mesh2=new THREE.Object3D,mesh2.position=g.position,mesh2.scale.x=mesh2.scale.y=mesh2.scale.z=150,d=new THREE.Mesh(c,new THREE.MeshBasicMaterial({color:a.fire_color,opacity:0.9,overdraw:!1})),mesh2.add(d),a.show_wireframes&&(c=new THREE.Mesh(c,new THREE.Mesh({color:16711680,opacity:0.9,shading:THREE.FlatShading,wireframe:!0,wireframeLinewidth:2,transparent:!0})),mesh2.add(c)),b.add(mesh2),v(mesh2,!1,150);s=new THREE.PointLight(a.orbit_light_color,
5,300);h.add(s);s.intensity=5;c=new THREE.SphereGeometry(5,16,8);k=new THREE.Mesh(c,new THREE.MeshBasicMaterial({color:a.orbit_light_color}));k.position=s.position;h.add(k);b.add(g);h.add(b);j(b);if(a.playSong){b=document.createElement("audio");for(c=0;c<a.playSong.length;c++)d=document.createElement("source"),d.src=a.playSong[c],b.appendChild(d);b.volume=a.playSong_volume;b.loop="loop";b.play()}n()})});r=new THREE.WebGLRenderer({antialias:!0});r.setSize(a.width,a.height);i.append(r.domElement);if(a.show_stats&&
typeof Stats!="undefined")l=new Stats,l.domElement.style.position="absolute",l.domElement.style.top="0px",l.domElement.style.right="0px",i.append(l.domElement);a.use_mouse&&document.addEventListener("mousemove",function(a){o=(a.clientX-u)*2;w=(a.clientY-C)*2},!1);var t=0}}var n=e(this),y=!1;if(a.enterOn=="now")j();else if(a.enterOn=="timer")setTimeout(j,a.delayTime);else if(a.enterOn=="click")n.bind("click",function(a){a.preventDefault();j()});else if(a.enterOn=="konami-code"){var o=[],u=a.konami_code;
e(window).bind("keydown.rocketz",function(a){o.push(a.keyCode);o.toString().indexOf(u)>=0&&(j(),o=[])},!0)}})}})(jQuery);
