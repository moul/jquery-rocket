(function(c){c.fn.rocket3d=function(a){var i={enterOn:"now",delayTime:5E3,width:c(window).width(),height:c(window).height(),far:1E4,near:0.1,angle:40,show_stats:!1,stars:800,konami_code:"38,38,40,40,37,39,37,39,66,65",show_wireframes:!1,use_mouse:!0,camera_z_position:1500,light_color:16777215,rocket_obj:"obj/rocket3d.js",rocket_tex:"tex/rocket3d_uvmap.png",fire_obj:"obj/rocket3d_flame.js",fire_color:16759552,onInitCallback:!1,playSong:"http://files.42k.fr/files/hehengT016-space.mp3"},a=c.extend(i,
a);return this.each(function(){function g(){function n(a,c){var b=Math.random()*100+100;(new TWEEN.Tween(c)).to({intensity:b/1.5},150).easing(TWEEN.Easing.Cubic.EaseIn).start();(new TWEEN.Tween(a.scale)).to({x:b,y:b,z:b},150).easing(TWEEN.Easing.Cubic.EaseIn).onComplete(function(){n(a,c,b)}).start()}function g(){requestAnimationFrame(g);d.position.x+=(i-d.position.x)*1;d.position.y+=(-k-d.position.y)*1;d.lookAt(e.position);o.position.x-=0.5;TWEEN.update();l.render(e,d);a.show_stats&&f&&f.update()}
if(!p)if(p=!0,typeof Detector=="undefined"||!Detector.webgl)Detector.addGetWebGLMessage();else{var d,e,j,l,b,h,f=!1,i=0,k=0,m=a.width/2,t=a.height/2;h=a.width/a.height;c("body").append('<div id="rocket3dcontainer"></div>');j=c("#rocket3dcontainer");j.css({position:"absolute",width:a.width,height:a.height,top:0,left:0});j.css({background:"#000000"});d=new THREE.PerspectiveCamera(a.angle,h,a.near,a.far);d.position.z=a.camera_z_position;e=new THREE.Scene;e.fog=new THREE.FogExp2(8947848,3.0E-4);e.fog.color.setHSV(0.1,
0.1,1);h=new THREE.DirectionalLight(a.light_color);h.position.set(0,0,1).normalize();e.add(h);var q=new THREE.JSONLoader;h=new THREE.ParticleBasicMaterial({color:16738047,size:15,blending:THREE.AdditiveBlending,transparent:!0});for(var r=new THREE.Geometry,s=0;s<a.stars;s++)r.vertices.push(new THREE.Vertex(new THREE.Vector3(Math.random()*a.camera_z_position*15-a.camera_z_position*3,Math.random()*a.camera_z_position*6-a.camera_z_position*3,-1E3)));var o=new THREE.ParticleSystem(r,h);e.add(o);q.load(a.rocket_obj,
function(d){d.materials[0].shading=THREE.FlatShading;b=new THREE.Object3D;b.position.x=-300;b.rotation.x=Math.PI/2;b.rotation.y=Math.PI*1.1;b.rotation.z=Math.PI/2;b.scale.x=b.scale.y=b.scale.z=150;e.add(b);var f=new THREE.Mesh(d,new THREE.MeshPhongMaterial({map:THREE.ImageUtils.loadTexture(a.rocket_tex)}));b.add(f);a.show_wireframes&&(d=new THREE.Mesh(d,new THREE.MeshLambertMaterial({color:16711680,opacity:0.9,shading:THREE.FlatShading,wireframe:!0,wireframeLinewidth:2,transparent:!0})),b.add(d));
j.parent().css("overflow","hidden");c("html,body").css("overflow","hidden");c("html:not(:animated),body:not(:animated)").animate({scrollTop:0},500);if(a.onInitCallback)a.onInitCallback();a.playSong&&c("body").append('<audio src="'+a.playSong+'" autoplay loop></audio>');g();q.load(a.fire_obj,function(b){b.materials[0].shading=THREE.FlatShading;mesh2=new THREE.Object3D;mesh2.position.x=-300;mesh2.rotation.x=Math.PI/2;mesh2.rotation.y=Math.PI*1.1;mesh2.rotation.z=Math.PI/2;mesh2.scale.x=mesh2.scale.y=
mesh2.scale.z=150;e.add(mesh2);var c=new THREE.Mesh(b,new THREE.MeshBasicMaterial({color:a.fire_color,opacity:0.9,overdraw:!1}));mesh2.add(c);a.show_wireframes&&(b=new THREE.Mesh(b,new THREE.Mesh({color:16711680,opacity:0.9,shading:THREE.FlatShading,wireframe:!0,wireframeLinewidth:2,transparent:!0})),mesh2.add(b));pointLight=new THREE.PointLight(a.fire_color);pointLight.position=mesh2.position;pointLight.position.x=mesh2.position.x;e.add(pointLight);n(mesh2,pointLight,150);g()})});l=new THREE.WebGLRenderer({antialias:!0});
l.setSize(a.width,a.height);j.append(l.domElement);if(a.show_stats&&typeof Stats!="undefined")f=new Stats,f.domElement.style.position="absolute",f.domElement.style.top="0px",f.domElement.style.right="0px",j.append(f.domElement);a.use_mouse&&document.addEventListener("mousemove",function(a){i=(a.clientX-m)*2;k=(a.clientY-t)*2},!1)}}var i=c(this),p=!1;if(a.enterOn=="now")g();else if(a.enterOn=="timer")setTimeout(g,a.delayTime);else if(a.enterOn=="click")i.bind("click",function(a){a.preventDefault();
g()});else if(a.enterOn=="konami-code"){var k=[],m=a.konami_code;c(window).bind("keydown.rocketz",function(a){k.push(a.keyCode);k.toString().indexOf(m)>=0&&(g(),k=[])},!0)}})}})(jQuery);
